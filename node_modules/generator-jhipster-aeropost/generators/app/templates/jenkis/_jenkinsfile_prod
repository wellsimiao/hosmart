pipeline {
    agent any
    tools {
            maven 'maven-3.5.3' 
    	    jdk 'java-8-openjdk'
        }
    stages {
        stage("Checkout") {
               steps {
                    git branch: '${branch}',
                        credentialsId: '<%=gitCredentialsId%>',
                        url: '<%=gitBranch%>'
               }
        }
        stage("Compile") { 
            steps {
                sh "chmod a+x ./mvnw"
                sh "./mvnw -Pprod,graphite clean package -DskipTests=true"
            }
        }
        stage("Docker") {
            steps {
                sh "./mvnw verify dockerfile:build -Pprod -DskipTests=true"
                sh "./mvnw dockerfile:push -Ddockerfile.useMavenSettingsForAuth=true -Pprod -s /opt/apache/maven/3.5.3/conf/settings.xml"
            }
        }
    }
}