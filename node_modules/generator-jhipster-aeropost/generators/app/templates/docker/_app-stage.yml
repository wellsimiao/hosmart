version: '3'
services:
    <%=baseName%>-stage:
        image: <%=dockerUrl%>/<%=businessArea%>/<%=projectName%>-stage:<%=version%>-stage
        environment:
            - _JAVA_OPTIONS=-Xmx512m -Xms256m
            - SPRING_PROFILES_ACTIVE=stage,swagger,graphite
            #EUREKA
            - EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE=<%=registryUrlStage%>
            - EUREKA_CLIENT_ENABLED=true
            - EUREKA_INSTANCE_PREFER_IP_ADDRESS=true
            #BOOTSTRAP
            - SPRING_CLOUD_CONFIG_URI=<%=springCloudUrlStage%>
            #SSL
            - SERVER_SSL_ENABLED=false
            <% if (hasOauth2) { %>
            #OAUTH
            - SECURITY_OAUTH2_CLIENT_SCOPE=openid
            - SECURITY_OAUTH2_CLIENT_CLIENT_SECRET=<%=clientSecret%>
            - SECURITY_OAUTH2_RESOURCE_USER_INFO_URI=<%=oauth2UrlStage%>/auth/realms/aeropost/protocol/openid-connect/userinfo
            - SECURITY_OAUTH2_CLIENT_ACCESS_TOKEN_URI=<%=oauth2UrlStage%>/auth/realms/aeropost/protocol/openid-connect/token
            - SECURITY_OAUTH2_CLIENT_USER_AUTHORIZATION_URI=<%=oauth2UrlStage%>/auth/realms/aeropost/protocol/openid-connect/auth
            <% } %> 
            #GRAPHITE
            - GRAPHITE_ENABLED=true
            - GRAPHITE_HOST=<%=graphiteUrl%> 
            - GRAPHITE_PORT=2003
            - GRAPHITE_PREFIX=stage.<%=businessArea%>-api.<%=baseName%>  
            #REDIS
            - SPRING_CACHE_TYPE=redis
            - SPRING_REDIS_HOST=redis-stage
            - SPRING_REDIS_PORT=6379 
            - SPRING_REDIS_DATABASE=1
        networks:
        - swarm-net

networks:
    swarm-net:
        external:
            name: swarm-net
